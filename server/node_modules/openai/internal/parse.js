"use strict";
// File generated from our OpenAPI spec by Stainless. See CONTRIBUTING.md for details.
Object.defineProperty(exports, "__esModule", { value: true });
exports.addRequestID = exports.defaultParseResponse = void 0;
const log_1 = require("./utils/log.js");
const streaming_1 = require("../streaming.js");
async function defaultParseResponse(props) {
    const { response } = props;
    if (props.options.stream) {
        (0, log_1.debug)('response', response.status, response.url, response.headers, response.body);
        // Note: there is an invariant here that isn't represented in the type system
        // that if you set `stream: true` the response type must also be `Stream<T>`
        if (props.options.__streamClass) {
            return props.options.__streamClass.fromSSEResponse(response, props.controller);
        }
        return streaming_1.Stream.fromSSEResponse(response, props.controller);
    }
    // fetch refuses to read the body when the status code is 204.
    if (response.status === 204) {
        return null;
    }
    if (props.options.__binaryResponse) {
        return response;
    }
    const contentType = response.headers.get('content-type');
    const isJSON = contentType?.includes('application/json') || contentType?.includes('application/vnd.api+json');
    if (isJSON) {
        const json = await response.json();
        (0, log_1.debug)('response', response.status, response.url, response.headers, json);
        return addRequestID(json, response);
    }
    const text = await response.text();
    (0, log_1.debug)('response', response.status, response.url, response.headers, text);
    // TODO handle blob, arraybuffer, other content types, etc.
    return text;
}
exports.defaultParseResponse = defaultParseResponse;
function addRequestID(value, response) {
    if (!value || typeof value !== 'object' || Array.isArray(value)) {
        return value;
    }
    return Object.defineProperty(value, '_request_id', {
        value: response.headers.get('x-request-id'),
        enumerable: false,
    });
}
exports.addRequestID = addRequestID;
//# sourceMappingURL=parse.js.map